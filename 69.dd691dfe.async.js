(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[69],{lrFF:function(e,t,a){"use strict";var l=a("mZ4U");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("NWD0");var n=l(a("2L3m"));a("4ADO");var i=l(a("wty1"));a("z7iZ");var r=l(a("O4+N"));a("SMEU");var s=l(a("xc0u"));a("C1KP");var u=l(a("d6B9"));a("pW4v");var d=l(a("OV+i"));a("yuUY");var h=l(a("2n5t"));a("Mf8d");var o=l(a("4OHk"));a("26gd");var c=l(a("1GiV")),p=l(a("xwgP")),m=l(a("EFm9")),f=a("kn+J"),g=l(a("N1TV")),v=a("03Q9"),y=l(a("L0Kt")),S=null;class w extends p.default.Component{constructor(e){super(e),this.handlSearch=(()=>{this.setState({loading:!0},()=>{var e=this.props.form;(0,f.historyList)(this.getParams()).then(t=>{this.setState({loading:!1,dataSource:t.list,total:t.totalCount,changeChannel:e.getFieldValue("channel")})})})}),this.onChangePage=((e,t)=>{this.setState({pageNo:e,pageSize:t},()=>{this.handlSearch()})}),this.getParams=(()=>{var e=this.props.form,t=Object.assign({},{pageNo:this.state.pageNo,pageSize:this.state.pageSize,sn:this.state.sn});if(""!==e.getFieldValue("channel")&&(t.channel=e.getFieldValue("channel")),""!==e.getFieldValue("date")){var a=e.getFieldValue("date");t.startTime=a[0].format("YYYY-MM-DD HH:mm:ss"),t.endTime=a[1].format("YYYY-MM-DD HH:mm:ss")}return t}),this.state={dataSource:[],channel:[{label:"\u5168\u90e8",value:"hall"},{label:1,value:"h1"},{label:2,value:"h2"},{label:3,value:"h3"},{label:4,value:"h4"},{label:5,value:"h5"},{label:6,value:"h6"},{label:7,value:"h7"},{label:8,value:"h8"}],pageNo:1,pageSize:4,total:6,initChannel:"hall",changeChannel:"",playNum:null,loading:!0}}componentDidMount(){this.handlSearch(),this.setState({sn:this.props.history.location.query.sn})}playHistoryVideo(e){clearInterval(S),S=null,this.setState({playNum:e.path});var t=this.state,a=t.initChannel,l=t.changeChannel;a!==l&&(0,f.stopVideo)({sn:this.state.sn,channel:a}).then(e=>{this.setState({initChannel:l})}),(0,f.startVideo)({sn:this.state.sn,channel:l,path:e.path}).then(e=>{e.success?(S=setInterval(()=>{(0,f.playingNotify)({sn:this.state.sn,channel:l})},2e4),(0,g.default)("/js/jswebrtc.min.js",()=>{var t=document.getElementById("video-historywebrtc"),a=e.result;new JSWebrtc.Player(a,{video:t})}),(0,g.default)("")):c.default.error(e.message)})}render(){var e=[{title:"\u65f6\u95f4",key:"time",render:e=>{return p.default.createElement("div",null,"".concat(e.start," - ").concat(e.end))}},{title:"\u6587\u4ef6\u5927\u5c0f",key:"filesize",dataIndex:"filesize",render:e=>{if(e){var t=(0,v.flowParse)(e);return p.default.createElement("div",null,t.flow+t.unit)}}},{title:"\u64cd\u4f5c",dataIndex:"operate",align:"center",render:(e,t)=>{return p.default.createElement(o.default,{onClick:()=>this.playHistoryVideo(t),type:this.state.playNum!==t.path?"play-circle":"pause-circle",style:{fontSize:28}})}}],t={current:this.state.pageNo,pageSize:this.state.pageSize,onChange:this.onChangePage,total:this.state.total},a=(this.props.visible,this.props.form.getFieldDecorator),l=h.default.Option,c=d.default.RangePicker,f=new Date(new Date((new Date).toLocaleDateString()).getTime()),g=new Date(new Date((new Date).toLocaleDateString()).getTime()+864e5-1),S=[(0,y.default)(f,"YYYY-MM-DD HH:mm"),(0,y.default)(g,"YYYY-MM-DD HH:mm")],w=p.default.createElement(u.default,{style:{flexDirection:"column"}},p.default.createElement(u.default.Item,{label:"\u901a\u9053\u53f7"},a("channel",{initialValue:"hall"})(p.default.createElement(h.default,{getPopupContainer:e=>e.parentNode},this.state.channel.map(e=>{return p.default.createElement(l,{value:e.value,key:e.value},e.label)})))),p.default.createElement(u.default.Item,{label:"\u65e5\u671f",style:{whiteSpace:"nowrap"}},a("date",{initialValue:S})(p.default.createElement(c,{allowClear:!1,getCalendarContainer:e=>e.parentNode}))));return p.default.createElement(n.default,null,p.default.createElement(i.default,{span:10,style:{height:"100vh",marginLeft:20}},p.default.createElement("div",{className:m.default.historyVideoSearch},w,p.default.createElement("div",null,p.default.createElement(s.default,{onClick:this.handlSearch,type:"primary",htmlType:"submit"},"\u67e5\u8be2"))),p.default.createElement(r.default,{columns:e,dataSource:this.state.dataSource,pagination:t,loading:this.state.loading})),p.default.createElement(i.default,{span:12,style:{height:"100vh"}},p.default.createElement("video",{style:{width:"55vw",height:"100%"},id:"video-historywebrtc",autoPlay:"autoplay",controls:!0})))}}var b=u.default.create()(w);t.default=b}}]);